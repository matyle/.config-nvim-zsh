exports.default=function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=2)}([function(t,e,n){"use strict";function r(t,e,n){return{name:"RichMarkdownOverlay-"+t,requiredSettings:n,token:function(n){const r=function(t,e){return t.lastIndex=e.pos,t.exec(e.string)}(e,n),i=n.baseToken();if((null==i?void 0:i.type)&&(i.type.includes("jn-inline-code")||i.type.includes("comment")||i.type.includes("katex")))n.pos+=i.size;else{if(r&&r.index===n.pos)return n.pos+=r[0].length||1,t;r?n.pos=r.index:n.skipToEnd()}return null}}}Object.defineProperty(e,"__esModule",{value:!0}),e.remove=e.add=e.table_regex=e.blockquote_regex=e.hr_regex=e.list_token_regex=e.header_regex=e.strike_token_regex=e.sup_token_regex=e.sub_token_regex=e.insert_token_regex=e.highlight_token_regex=e.strong_underline_regex=e.strong_star_regex=e.emph_underline_regex=e.emph_star_regex=e.sup_regex=e.sub_regex=e.insert_regex=e.highlight_regex=e.html_image_regex=e.image_regex=e.link_regex=e.checkbox_inner_regex=e.checkbox_regex=void 0,e.checkbox_regex=/^(\s*)([*+-] )(\[[Xx ]\])\s.*$/g,e.checkbox_inner_regex=/(?<=\[)[Xx ](?=\])/g,e.link_regex=/(?<![\\])\[[^\]]*\]\(([^\(]+)\)|<([^>\s]+\.[^>\s]+)>|(https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9]+\.[^\s]{2,}|www\.[a-zA-Z0-9]+\.[^\s]{2,}[^\)])/g,e.image_regex=/!\[[^\]]*\]\([^\(]+\)/g,e.html_image_regex=/<img([^>]+?)\/?>/g,e.highlight_regex=/(?<!\\)==(?=[^\s])[^=]*[^=\s\\]==/g,e.insert_regex=/(?<!\\)\+\+(?=[^\s])[^\+]*[^\+\s\\]\+\+/g,e.sub_regex=/(?<![\\~])~(?=[^\s])[^~]*[^~\s\\]~/g,e.sup_regex=/(?<![\\[])\^(?=[^\s])[^\^]*[^\^\s\\[]\^/g,e.emph_star_regex=/(?<![\\\*])\*(?!\*)/g,e.emph_underline_regex=/(?<![\\\_])\_(?!\_)/g,e.strong_star_regex=/(?<![\\\*])\*\*(?!\*)/g,e.strong_underline_regex=/(?<![\\\_])\_\_(?!\_)/g,e.highlight_token_regex=/(?<![\\=])==(?!=)/g,e.insert_token_regex=/(?<![\\\+])\+\+(?!\+)/g,e.sub_token_regex=/(?<![\\~])~(?!~)/g,e.sup_token_regex=/(?<![\\\^])\^(?!\^)/g,e.strike_token_regex=/(?<![\\~])~~(?!~~)/g,e.header_regex=/^\s*#+\s/g,e.list_token_regex=/^(\s*)([*+-] \[[Xx ]\]\s|[*+->]\s|(\d+)([.)]\s))(\s*)/g,e.hr_regex=/^([*\-_])(?:\s*\1){2,}\s*$/,e.blockquote_regex=/^\s*\>+\s/g,e.table_regex=/^\|[^\n]+\|/g;const i=[r("rm-checkbox",e.checkbox_regex,[]),r("rm-checkbox-check",e.checkbox_inner_regex,["extraCSS"]),r("rm-link",e.link_regex,[]),r("rm-image",e.image_regex,[]),r("rm-image",e.html_image_regex,[]),r("rm-list-token",e.list_token_regex,[]),r("rm-ins",e.insert_regex,["insertHighlight"]),r("rm-sub",e.sub_regex,["subHighlight"]),r("rm-sup",e.sup_regex,["supHighlight"]),r("rm-header-token",e.header_regex,["extraCSS"]),r("line-cm-rm-blockquote",e.blockquote_regex,["extraCSS"]),r("rm-em-token",e.emph_star_regex,["extraCSS"]),r("rm-em-token",e.emph_underline_regex,["extraCSS"]),r("rm-strong-token",e.strong_star_regex,["extraCSS"]),r("rm-strong-token",e.strong_underline_regex,["extraCSS"]),r("rm-highlight",e.highlight_regex,["extraCSS","markHighlight"]),r("rm-highlight-token",e.highlight_token_regex,["extraCSS","markHighlight"]),r("rm-ins-token",e.insert_token_regex,["extraCSS","insertHighlight"]),r("rm-sub-token",e.sub_token_regex,["extraCSS","subHighlight"]),r("rm-sup-token",e.sup_token_regex,["extraCSS","supHighlight"]),r("rm-strike-token",e.strike_token_regex,["extraCSS"]),r("rm-hr line-cm-rm-hr",e.hr_regex,["extraCSS"])];function o(t,e){for(let n of e)if(!t[n])return!1;return!0}e.add=function(t){if(t.state.richMarkdown)for(let e of i)o(t.state.richMarkdown.settings,e.requiredSettings)&&t.addOverlay(e)},e.remove=function(t){for(let e of i)t.removeOverlay(e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.clickAt=e.getClickCoord=e.getMatchAt=e.isCheckbox=e.isLink=void 0;const r=n(0);function i(t,e,n){let r=null;if(e.lastIndex=0,!e.global)return console.error("getMatchAt requires a global regex; Consider adding a `g` after ${regex}"),null;do{if(r=e.exec(t),!r)break;const i=r.index,o=i+r[0].length;if(i<=n&&n<=o)return r}while(r);return null}e.isLink=function(t){return!!t.target&&t.target.classList.contains("cm-rm-link")},e.isCheckbox=function(t){return!!t.target&&t.target.classList.contains("cm-rm-checkbox")},e.getMatchAt=i,e.getClickCoord=function(t,e){return(n=t.coordsChar({left:e.clientX,top:e.clientY})).sticky&&"before"===n.sticky?{ch:n.ch-1,line:n.line}:n;var n},e.clickAt=function(t,e){if(!t.state.richMarkdown)return;const n=t.state.richMarkdown.settings;if(n.links){const n=function(t,e){let{line:n,ch:o}=e;const s=t.getLine(n),a=i(s,r.link_regex,o);if(!a)return;let c="";for(let t=1;t<=4;t++)c=c||a[t];c&&c.endsWith(")")?i(s,r.image_regex,o)&&(c=c.slice(0,c.length-1)):c&&(c.endsWith('"')||c.endsWith("'"))&&(c=c.slice(0,c.length-1));return c=c.split(" ")[0],c}(t,e);if(n)return{name:"followLink",url:n}}return n.checkbox&&function(t,e){const n=t.getCursor(),{line:o,ch:s}=e,a=t.getLine(o),c=i(a,r.checkbox_regex,s);if(!c||!c[3])return!1;let l=a.indexOf(c[3]),g=l+c[3].length;const u=" "===c[3][1]?"[x]":"[ ]";t.replaceRange(u,{ch:l,line:o},{ch:g,line:o},"+input"),t.setCursor(n,null,{scroll:!1})}(t,e),null}},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const i=n(3),o=n(1),s=n(0),a=n(4);t.exports={default:function(t){return{plugin:function(e){function n(e){return r(this,void 0,void 0,(function*(){return yield t.postMessage({name:"getResourcePath",id:e})}))}function c(t,e){const n=t.state.richMarkdown.settings;if(!n.clickCtrl)return!0;let r=!1;return n.clickAlt&&(r=r||e.altKey),r=navigator.platform.toUpperCase().indexOf("MAC")>=0?r||e.metaKey:r||e.ctrlKey,r}function l(t,n,r){a.onRenderLine(t,n,r,e)}function g(t,e){const{from:n,to:r}=function(t){const e=t.from.line;let n=t.to.line;return n-=t.removed.length,n+=t.text.length,{from:e,to:n}}(e);i.onSourceChanged(t,n,r)}function u(t){i.afterSourceChanges(t)}function d(e,n){return r(this,void 0,void 0,(function*(){if(!e.state.richMarkdown)return;if(c(e,n)&&(o.isLink(n)||o.isCheckbox(n))){const r=o.getClickCoord(e,n),i=o.clickAt(e,r);i&&t.postMessage(i),n.preventDefault()}}))}function h(t,e,n){if(!n.target)return;let r="";(e.links&&o.isLink(n)||e.checkbox&&o.isCheckbox(n))&&(r=c(t,n)?"pointer":r);n.target.style.cursor=r}e.defineExtension("initializeRichMarkdown",(function(t){this.state.richMarkdown={settings:t,path_from_id:n},this.on("change",g),this.on("update",u),this.on("mousedown",d),this.on("renderLine",l),s.add(this),a.calculateSpaceWidth(this),t.inlineImages&&t.scanImgChangePeriod>0&&(this.state.richMarkdown.scanImgInterval=setInterval(i.refreshAllWidgets,1e3*t.scanImgChangePeriod,this)),this.updateRichMarkdownSettings(t)})),e.defineExtension("updateRichMarkdownSettings",(function(t){var e,n;this.state.richMarkdown&&(this.state.richMarkdown.settings=t,i.clearAllWidgets(this),i.onSourceChanged(this,this.firstLine(),this.lastLine()),i.afterSourceChanges(this),t.activeLine?this.setOption("styleActiveLine",{nonEmpty:!0}):this.setOption("styleActiveLine",!1),this.getWrapperElement().onmousemove=(e=this,n=t,function(t){h(e,n,t)}),this.getWrapperElement().onmouseup=function(t,e){return function(n){h(t,e,n)}}(this,t),this.state.richMarkdown.scanImgInterval&&clearInterval(this.state.richMarkdown.scanImgInterval),t.inlineImages&&t.scanImgChangePeriod>0&&(this.state.richMarkdown.scanImgInterval=setInterval(i.refreshAllWidgets,1e3*t.scanImgChangePeriod,this)))})),e.defineExtension("clickUnderCursor",(function(){const e=this.getCursor("head"),n=o.clickAt(this,e);n&&t.postMessage(n)})),e.defineOption("enable-rich-mode",!1,(function(n,o,a){return r(this,void 0,void 0,(function*(){if(a&&a!=e.Init&&(n.off("change",g),n.off("update",u),n.off("mousedown",d),n.off("renderLine",l),s.remove(n),n.state.richMarkdown=null,i.clearAllWidgets(n),clearInterval(this.state.richMarkdown.scanImgInterval)),o){setTimeout((function e(i){return r(this,void 0,void 0,(function*(){const o=yield function(){return r(this,void 0,void 0,(function*(){return yield t.postMessage({name:"getSettings"})}))}();o?n.initializeRichMarkdown(o):setTimeout(e,2*i,2*i)}))}),50,100)}}))}))},codeMirrorResources:["addon/selection/active-line","addon/selection/mark-selection"],codeMirrorOptions:{"enable-rich-mode":!0,styleSelectedText:!0},assets:function(){return[{mime:"text/css",inline:!0,text:".cm-rm-monospace {\n\t\t\t\t\t\t\t\t\t\t\tfont-family: monospace !important;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t.cm-rm-ins {\n\t\t\t\t\t\t\t\t\t\t\ttext-decoration: underline;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t.cm-rm-sub {\n\t\t\t\t\t\t\t\t\t\t\tvertical-align: sub;\n\t\t\t\t\t\t\t\t\t\t\tfont-size: smaller;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t.cm-rm-sup {\n\t\t\t\t\t\t\t\t\t\t\tvertical-align: super;\n\t\t\t\t\t\t\t\t\t\t\tfont-size: smaller;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t.cm-rm-highlight {\n\t\t\t\t\t\t\t\t\t\t\tbackground-color: var(--joplin-search-marker-background-color);\n\t\t\t\t\t\t\t\t\t\t\tcolor: var(--joplin-search-marker-color);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t.CodeMirror-selectedtext.cm-rm-highlight {\n\t\t\t\t\t\t\t\t\t\t\tbackground-color: #e5d3ce;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t/* Needed for the renderLine indent hack to work */\n\t\t\t\t\t\t\t\t\t\t.CodeMirror pre > * { text-indent: 0px; }\n\t\t\t\t\t\t\t"}]}}}}},function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.clearAllWidgets=e.refreshAllWidgets=e.afterSourceChanges=e.onSourceChanged=e.html_image_line_regex=e.image_inline_regex=e.image_line_regex=void 0;const i=n(1),o=n(0);function s(t){return function(n){return r(this,void 0,void 0,(function*(){if(!n.target)return;if(!t.state.richMarkdown)return;if(!t.state.richMarkdown.settings.imageHover)return;if(!t.state.richMarkdown.settings.imageHoverCtrl&&(!n.ctrlKey&&!n.altKey||t.state.richMarkdown.isMouseHovering))return;t.state.richMarkdown.isMouseHovering=!0;const s=n.target;if(!s.offsetParent)return;if(t.state.richMarkdown.settings.inlineImages&&s.parentNode.childNodes.length<=3)return;const a=yield function(t,n){return r(this,void 0,void 0,(function*(){let{line:r,ch:s}=n;const a=t.getLine(r),c=i.getMatchAt(a,e.image_inline_regex,s);let u=null;if(c)u=yield g(c[2],c[1],t.state.richMarkdown.path_from_id);else{const e=i.getMatchAt(a,o.html_image_regex,s);e&&(u=yield l(e[0],t.state.richMarkdown.path_from_id))}return u}))}(t,i.getClickCoord(t,n));if(a){if(a.style.zoom){let t=parseFloat(a.style.zoom);a.style.zoom.endsWith("%")&&(t/=100),t&&(a.width*=t,a.height*=t,a.style.zoom="100%")}a.style.visibility="hidden",s.offsetParent.appendChild(a),a.style.position="absolute",a.style.zIndex="1000",a.classList.add("rich-markdown-hover-image"),a.onload=function(){if(!t.state.richMarkdown)return;if(!t.state.richMarkdown.isMouseHovering)return void a.remove();let e=this;const r=s.offsetParent,{right:i,width:o}=r.getBoundingClientRect();let c=0;e.clientWidth<o&&(c=Math.min(n.clientX,i-e.clientWidth));const l=t.coordsChar({left:c,top:n.clientY},"page");e.style.visibility="visible",t.addWidget(l,a,!1)}}}))}}function a(t){const e=t.getWrapperElement().getElementsByClassName("rich-markdown-hover-image");for(let t=e.length-1;t>=0;t--)e[t].remove()}function c(t){return function(e){t.state.richMarkdown&&(t.state.richMarkdown.isMouseHovering=!1),a(t)}}function l(t,e){return r(this,void 0,void 0,(function*(){const n=(new DOMParser).parseFromString(t,"text/html").body.firstChild;n.style.height=n.style.height||"auto",n.style.maxWidth=n.style.maxWidth||"100%";const r=["script","noscript","iframe","frameset","frame","object","base","embed","link","meta"];for(let t=0;t<n.attributes.length;t++){const e=n.attributes[t].name;(r.includes(e)||e.startsWith("on"))&&(n.attributes[t].value="")}if(n.src.length>=34){const t=n.src.substring(n.src.length-34);t.startsWith(":/")&&(n.src=yield e(t.substring(2)))}return n}))}function g(t,e,n){return r(this,void 0,void 0,(function*(){t.startsWith(":/")&&34==t.length&&(t=yield n(t.substring(2))),t.startsWith("<")&&t.endsWith(">")&&(t=t.substring(1,t.length-1));const r=document.createElement("img");return r.src=t,r.alt=e,r.style.maxWidth="100%",r.style.height="auto",r}))}function u(t){for(let e=t.firstLine();e<=t.lastLine();e++){const n=t.lineInfo(e),r=(new Date).getTime();let i="";if(n.widgets)for(const e of n.widgets)if("rich-markdown-resource"===e.className){i=e.node.src.split("?t=")[0];const n=e.node.width,o=e.node.height;e.node.onload=function(){this.clientWidth==n&&this.clientHeight==o||t.refresh()},e.node.src=`${i}?t=${r}`}}}e.image_line_regex=/^\s*!\[([^\]]*)\]\((<[^\)]+>|[^)\s]+)[^)]*\)\s*$/,e.image_inline_regex=/!\[([^\]]*)\]\((<[^\)]+>|[^)\s]+)[^)]*\)/g,e.html_image_line_regex=/^\s*<img([^>]+?)\/?>\s*$/,e.onSourceChanged=function(t,n,i){t.state.richMarkdown&&t.state.richMarkdown.settings.inlineImages&&(!function(t,n,i){var o,s,a;r(this,void 0,void 0,(function*(){if(!t.state.richMarkdown)return;const r=t.state.richMarkdown.path_from_id;for(let c=n;c<=i;c++){const n=t.lineInfo(c);if(n.widgets)for(const t of n.widgets)"rich-markdown-resource"===t.className&&t.clear();if(!n)continue;const i=t.getStateAfter(c,!0);if((null==i?void 0:i.outer)&&((null===(o=null==i?void 0:i.outer)||void 0===o?void 0:o.code)||(null===(a=null===(s=null==i?void 0:i.outer)||void 0===s?void 0:s.thisLine)||void 0===a?void 0:a.fencedCodeEnd)))continue;const u=n.text.match(e.image_line_regex);let d=null;if(u)d=yield g(u[2],u[1],r);else{const t=n.text.match(e.html_image_line_regex);t&&(d=yield l(t[0],r))}if(d){t.addLineWidget(c,d,{className:"rich-markdown-resource"})}}}))}(t,n,i),u(t))},e.afterSourceChanges=function(t){t.state.richMarkdown&&t.state.richMarkdown.settings.imageHover&&function(t){if(!t.state.richMarkdown)return;const e=t.getWrapperElement().getElementsByClassName("cm-rm-image");for(let n of e)n.onmouseenter=s(t),n.onmouseleave=c(t),t.state.richMarkdown.settings.imageHoverCtrl||(n.onmousemove=s(t))}(t)},e.refreshAllWidgets=u,e.clearAllWidgets=function(t){a(t);for(let e=t.firstLine();e<=t.lastLine();e++){const n=t.lineInfo(e);if(n.widgets)for(const t of n.widgets)"rich-markdown-resource"===t.className&&t.clear()}t.refresh()}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.onRenderLine=e.calculateSpaceWidth=void 0;const r=n(0);let i=0,o=0,s=0;function a(t,e,n){let r=document.createElement("span");n&&r.classList.add(n),r.style.whiteSpace="pre-wrap",r.appendChild(document.createTextNode(e.repeat(10)));const i=t.getWrapperElement().getElementsByClassName("CodeMirror-measure")[0];i.firstChild&&i.removeChild(i.firstChild),i.appendChild(r);const o=r.getBoundingClientRect();return(o.right-o.left)/10||t.defaultCharWidth()}e.calculateSpaceWidth=function(t){i=a(t," ",""),o=a(t," ","cm-rm-monospace"),s=a(t,">","")},e.onRenderLine=function(t,e,n,a){if(t.state.richMarkdown&&t.state.richMarkdown.settings.alignIndent){const c=e.text.match(r.list_token_regex);if(!c)return;let l=a.countColumn(e.text,c[0].length,t.getOption("tabSize"))*i;t.state.richMarkdown.settings.enforceMono&&c[0].indexOf("[")>0?l+=6*o-6*i:t.state.richMarkdown.settings.enforceMono&&c[0].indexOf(">")>=0&&(l+=s-i),n.style.textIndent="-"+l+"px",n.style.paddingLeft=l+"px"}}}]).default;