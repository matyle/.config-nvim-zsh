!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=joplin},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,a){function r(e){try{u(o.next(e))}catch(e){a(e)}}function d(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,d)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.updateDatabase=t.openRecurrenceDialog=t.main=void 0;const i=n(0),a=n(5),r=n(8),d=n(9),u=n(10),l=n(11),s=n(2);function c(e){return o(this,void 0,void 0,(function*(){1==e.type?(yield u.getRecord(e.item_id))||(yield u.createRecord(e.item_id,new s.Recurrence)):2==e.type?yield y(e.item_id):(e.type=3)&&(yield u.deleteRecord(e.id))}))}function y(e){return o(this,void 0,void 0,(function*(){var t=yield l.getNote(e),n=yield u.getRecord(e);if(0!=t.todo_completed&&0!=t.todo_due&&n.enabled){var o=new Date(t.todo_due),i=n.getNextDate(o);yield l.setTaskDueDate(e,i),yield l.markTaskUncompleted(e),n.updateStopStatus(),u.updateRecord(e,n)}}))}t.main=function(){return o(this,void 0,void 0,(function*(){yield u.setupDatabase(),yield a.createDialog(),yield d.setupUpdateMenu(),yield r.setupDialogButton(),yield l.connectNoteChangedCallback(c)}))},t.openRecurrenceDialog=function(){return o(this,void 0,void 0,(function*(){var e=yield i.default.workspace.selectedNote(),t=yield u.getRecord(e.id),n=yield a.openDialog(t);n&&(yield u.updateRecord(e.id,n))}))},t.updateDatabase=function(){return o(this,void 0,void 0,(function*(){for(var e of yield l.getAllNotes())(yield u.getRecord(e.id))||(yield u.createRecord(e.id,new s.Recurrence)),y(e.id);for(var t of yield u.getAllRecords())(yield l.getNote(t.id))||(yield u.deleteRecord(t.id))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Recurrence=void 0;const o=n(6);t.Recurrence=class{constructor(){this.enabled=!1,this.interval="minute",this.intervalNumber=1,this.weekSunday=!1,this.weekMonday=!1,this.weekTuesday=!1,this.weekWednesday=!1,this.weekThursday=!1,this.weekFriday=!1,this.weekSaturday=!1,this.monthOrdinal="first",this.monthWeekday="",this.stopType="never",this.stopDate=null,this.stopNumber=1,this.weekdayStrings=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],this.monthOrdinalStrings=["first","second","third","fourth","last"]}getString(){var e="";if(this.enabled)if(1==this.intervalNumber?e+="Every "+this.interval:this.intervalNumber>1&&(e+=`Every ${this.intervalNumber} ${this.interval}s`),"week"==this.interval){var t=this.getWeekdaysInt().map((e,t,n)=>o.capitalize(this.weekdayStrings[e]));if(1==t.length)e+=" on "+t.pop();else if(2==t.length)e+=` on ${t.shift()} and ${t.shift()}`;else if(t.length>2){var n=t.pop();e+=` on ${t.join(", ")} and ${n}`}}else"month"==this.interval&&""!=this.monthOrdinal&&""!=this.monthWeekday&&(e+=` on the ${this.monthOrdinal} ${o.capitalize(this.monthWeekday)}`);else e="Never";return e}getNextDate(e){if(this.enabled){var t=new Date(e.getTime());if("minute"==this.interval)t.setMinutes(e.getMinutes()+this.intervalNumber);else if("hour"==this.interval)t.setHours(e.getHours()+this.intervalNumber);else if("day"==this.interval)t.setDate(e.getDate()+this.intervalNumber);else if("week"==this.interval){if(t.setDate(t.getDate()+7*this.intervalNumber),this.getWeekdaysInt().length>0){var n=this.getWeekdays(e).concat(this.getWeekdays(t));for(var o of(n.sort((e,t)=>e.getTime()-t.getTime()),n))if(o.getTime()>e.getTime()){t.setTime(o.getTime());break}}}else if("month"==this.interval){if(t.setMonth(e.getMonth()+this.intervalNumber),""!=this.monthOrdinal&&""!=this.monthWeekday){var i=[new Date(this.getMonthWeekday(e)),new Date(this.getMonthWeekday(t))];for(var a of(i.sort((e,t)=>e.getTime()-t.getTime()),i))if(a>e){t.setTime(a.getTime());break}}}else"year"==this.interval&&t.setFullYear(e.getFullYear()+this.intervalNumber);return t}}updateStopStatus(){"date"==this.stopType&&new Date(this.stopDate)<new Date?this.enabled=!1:"number"==this.stopType&&(this.stopNumber<=1?this.enabled=!1:this.stopNumber=this.stopNumber-1)}getWeekdays(e){return this.getWeekdaysInt().map(t=>{var n=new Date(e);return n.setDate(n.getDate()-n.getDay()+t),n})}getWeekdaysInt(){var e=[];return 1==this.weekSunday&&e.push(0),1==this.weekMonday&&e.push(1),1==this.weekTuesday&&e.push(2),1==this.weekWednesday&&e.push(3),1==this.weekThursday&&e.push(4),1==this.weekFriday&&e.push(5),1==this.weekSaturday&&e.push(6),e}getMonthWeekday(e){var t=this.monthOrdinalStrings.indexOf(this.monthOrdinal),n=this.weekdayStrings.indexOf(this.monthWeekday),o=[],i=new Date(e),a=i.getMonth();for(i.setDate(1);i.getMonth()===a;)i.getDay()==n&&o.push(new Date(i)),i.setDate(i.getDate()+1);return 4==t?o.pop():o[t]}}},function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.ContentScriptType=t.SettingStorage=t.AppType=t.SettingItemType=t.ToolbarButtonLocation=t.isContextMenuItemLocation=t.MenuItemLocation=t.ImportModuleOutputFormat=t.FileSystemItem=void 0,function(e){e.File="file",e.Directory="directory"}(t.FileSystemItem||(t.FileSystemItem={})),function(e){e.Markdown="md",e.Html="html"}(t.ImportModuleOutputFormat||(t.ImportModuleOutputFormat={})),function(e){e.File="file",e.Edit="edit",e.View="view",e.Note="note",e.Tools="tools",e.Help="help",e.Context="context",e.NoteListContextMenu="noteListContextMenu",e.EditorContextMenu="editorContextMenu",e.FolderContextMenu="folderContextMenu",e.TagContextMenu="tagContextMenu"}(o=t.MenuItemLocation||(t.MenuItemLocation={})),t.isContextMenuItemLocation=function(e){return[o.Context,o.NoteListContextMenu,o.EditorContextMenu,o.FolderContextMenu,o.TagContextMenu].includes(e)},function(e){e.NoteToolbar="noteToolbar",e.EditorToolbar="editorToolbar"}(t.ToolbarButtonLocation||(t.ToolbarButtonLocation={})),function(e){e[e.Int=1]="Int",e[e.String=2]="String",e[e.Bool=3]="Bool",e[e.Array=4]="Array",e[e.Object=5]="Object",e[e.Button=6]="Button"}(t.SettingItemType||(t.SettingItemType={})),function(e){e.Desktop="desktop",e.Mobile="mobile",e.Cli="cli"}(t.AppType||(t.AppType={})),function(e){e[e.Database=1]="Database",e[e.File=2]="File"}(t.SettingStorage||(t.SettingStorage={})),function(e){e.MarkdownItPlugin="markdownItPlugin",e.CodeMirrorPlugin="codeMirrorPlugin"}(t.ContentScriptType||(t.ContentScriptType={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(0),i=n(1);o.default.plugins.register({onStart:i.main})},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,a){function r(e){try{u(o.next(e))}catch(e){a(e)}}function d(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,d)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.openDialog=t.createDialog=void 0;const i=n(0),a=n(2);var r=null;t.createDialog=function(){return o(this,void 0,void 0,(function*(){r=yield i.default.views.dialogs.create("Dialog"),yield i.default.views.dialogs.addScript(r,"./GUI/Dialog/Dialog.js"),yield i.default.views.dialogs.addScript(r,"./GUI/Dialog/Dialog.css")}))},t.openDialog=function(e){return o(this,void 0,void 0,(function*(){var t,o=(yield n(7).default).replace("RECURRENCE_DATA",btoa((t=e,JSON.stringify({enabled:t.enabled,interval:t.interval,intervalNumber:t.intervalNumber,weekSunday:t.weekSunday,weekMonday:t.weekMonday,weekTuesday:t.weekTuesday,weekWednesday:t.weekWednesday,weekThursday:t.weekThursday,weekFriday:t.weekFriday,weekSaturday:t.weekSaturday,monthOrdinal:t.monthOrdinal,monthWeekday:t.monthWeekday,stopType:t.stopType,stopDate:t.stopDate,stopNumber:t.stopNumber}))));yield i.default.views.dialogs.setHtml(r,o);var d=yield i.default.views.dialogs.open(r);if("ok"==d.id)return function(e){var t=JSON.parse(e),n=new a.Recurrence;return n.enabled=Boolean(t.enabled),n.intervalNumber=Number(t.intervalNumber),n.interval=String(t.interval),n.weekSunday=Boolean(t.weekSunday),n.weekMonday=Boolean(t.weekMonday),n.weekTuesday=Boolean(t.weekTuesday),n.weekWednesday=Boolean(t.weekWednesday),n.weekThursday=Boolean(t.weekThursday),n.weekFriday=Boolean(t.weekFriday),n.weekSaturday=Boolean(t.weekSaturday),n.monthOrdinal=String(t.monthOrdinal),n.monthWeekday=String(t.monthWeekday),n.stopType=String(t.stopType),n.stopDate=String(t.stopDate),n.stopNumber=Number(t.stopNumber),n}(atob(d.formData.recurrenceForm.recurrenceData))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.capitalize=void 0,t.capitalize=function(e){return e[0].toUpperCase()+e.substr(1).toLowerCase()}},function(e,t,n){"use strict";n.r(t),t.default='<h1>Repeating To-Do</h1>\n<form name="recurrenceForm">\n\n    <input id="recurrenceDataInput" type="hidden" name="recurrenceData" value="RECURRENCE_DATA">\n\n    <fieldset id="enabledFieldset">\n        <legend>Enabled</legend>\n        <input id="enabledCheckbox" type="checkbox" value="True">\n        <label for="enabledCheckbox">This To-Do Repeats</label>\n    </fieldset>\n\n    <fieldset id="intervalFieldset">\n        <legend>Interval</legend>\n        <input id="intervalNumberSpinbutton" type="number" min="1" max="999" step="1" value="1">\n        <select id="intervalDropdown">\n            <option value="minute" selected>Minute</option>\n            <option value="hour">Hour</option>\n            <option value="day">Day</option>\n            <option value="week">Week</option>\n            <option value="month">Month</option>\n            <option value="year">Year</option>\n        </select>\n    </fieldset>\n\n    <fieldset id="weekFieldset">\n        <legend>Weekdays</legend>\n        <table>\n            <tr>\n                <td><input id="weekSundayCheckbox" type="checkbox" value="true"></td>\n                <td><label for="weekSundayCheckbox">Sunday</label></td>\n            </tr>\n            <tr>\n                <td><input id="weekMondayCheckbox" type="checkbox" value="true"></td>\n                <td><label for="weekMondayCheckbox">Monday</label></td>\n            </tr>\n            <tr>\n                <td><input id="weekTuesdayCheckbox" type="checkbox" value="true"></td>\n                <td><label for="weekTuesdayCheckbox">Tuesday</label></td>\n            </tr>\n            <tr>\n                <td><input id="weekWednesdayCheckbox" type="checkbox" value="true"></td>\n                <td><label for="weekWednesdayCheckbox">Wednesday</label></td>\n            </tr>\n            <tr>\n                <td><input id="weekThursdayCheckbox" type="checkbox" value="true"></td>\n                <td><label for="weekThursdayCheckbox">Thursday</label></td>\n            </tr>\n            <tr>\n                <td><input id="weekFridayCheckbox" type="checkbox" value="true"></td>\n                <td><label for="weekFridayCheckbox">Friday</label></td>\n            </tr>\n            <tr>\n                <td><input id="weekSaturdayCheckbox" type="checkbox" value="true"></td>\n                <td><label for="weekdaySaturdayCheckbox">Saturday</label></td>\n            </tr>\n        </table>\t\n    </fieldset>\n\n    <fieldset id="monthFieldset">\n        <legend>Weekday of Month</legend>\n        <select id="monthOrdinalDropdown"">\n            <option value="first" selected>First</option>\n            <option value="second">Second</option>\n            <option value="third">Third</option>\n            <option value="fourth">Fourth</option>\n            <option value="last">Last</option>\n        </select>\n        <select id="monthWeekdayDropdown"">\n            <option value="" selected>None</option>\n            <option value="sunday">Sunday</option>\n            <option value="monday">Monday</option>\n            <option value="tuesday">Tuesday</option>\n            <option value="wednesday">Wednesday</option>\n            <option value="thursday">Thursday</option>\n            <option value="friday">Friday</option>\n            <option value="saturday">Saturday</option>\n        </select>\n    </fieldset>\n\n    <fieldset id="stopFieldset">\n        <legend>Repeating Stops</legend>\n        <select id="stopTypeDropdown"">\n            <option value="never">Never</option>\n            <option value="number">After # of Repeats</option>\n            <option value="date">After a date</option>\n        </select>\n        <input id="stopNumberSpinbutton" type="number" min="1" max="999" step="1" value="1">\n        <input id="stopDatePicker" type="date">\n    </fieldset>\n\n</form>\n'},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,a){function r(e){try{u(o.next(e))}catch(e){a(e)}}function d(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,d)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.setupDialogButton=void 0;const i=n(0),a=n(3),r=n(1);t.setupDialogButton=function(){return o(this,void 0,void 0,(function*(){yield i.default.commands.register({name:"openRecurrenceDialog",label:"Open Recurrence Dialog",iconName:"fas fa-redo-alt",execute:()=>o(this,void 0,void 0,(function*(){r.openRecurrenceDialog()}))}),yield i.default.views.toolbarButtons.create("openRecurrenceDialogButton","openRecurrenceDialog",a.ToolbarButtonLocation.NoteToolbar)}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,a){function r(e){try{u(o.next(e))}catch(e){a(e)}}function d(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,d)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.setupUpdateMenu=void 0;const i=n(0),a=n(3),r=n(1);t.setupUpdateMenu=function(){return o(this,void 0,void 0,(function*(){yield i.default.commands.register({name:"updateRecurrenceDatabase",label:"Update Recurrence Database",iconName:"fas fa-redo-alt",execute:()=>o(this,void 0,void 0,(function*(){r.updateDatabase()}))}),yield i.default.views.menus.create("recurrenceMenu","Repeating Todos",[{label:"updateRecurrenceDatabase",commandName:"updateRecurrenceDatabase"}],a.MenuItemLocation.Tools)}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,a){function r(e){try{u(o.next(e))}catch(e){a(e)}}function d(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,d)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteRecord=t.updateRecord=t.getRecord=t.getAllRecords=t.createRecord=t.setupDatabase=void 0;const i=n(0),a=n(2),r=i.default.require("fs-extra"),d=i.default.require("sqlite3");var u=null;function l(e,t){return o(this,void 0,void 0,(function*(){var n={$id:e,$enabled:t.enabled,$interval:t.interval,$intervalNumber:t.intervalNumber,$weekSunday:t.weekSunday,$weekMonday:t.weekMonday,$weekTuesday:t.weekTuesday,$weekWednesday:t.weekWednesday,$weekThursday:t.weekThursday,$weekFriday:t.weekFriday,$weekSaturday:t.weekSaturday,$monthOrdinal:t.monthOrdinal,$monthWeekday:t.monthWeekday,$stopType:t.stopType,$stopDate:t.stopDate,$stopNumber:t.stopNumber};yield s("run","\n        UPDATE Recurrence\n        SET\n            enabled = $enabled,\n            interval = $interval,\n            intervalNumber = $intervalNumber,\n            weekSunday = $weekSunday,\n            weekMonday = $weekMonday,\n            weekTuesday = $weekTuesday,\n            weekWednesday = $weekWednesday,\n            weekThursday = $weekThursday,\n            weekFriday = $weekFriday,\n            weekSaturday = $weekSaturday,\n            monthOrdinal = $monthOrdinal,\n            monthWeekday = $monthWeekday,\n            stopType = $stopType,\n            stopDate = $stopDate,\n            stopNumber = $stopNumber\n        WHERE id = $id\n    ",n)}))}function s(e,t,n){return o(this,void 0,void 0,(function*(){return yield new Promise((o,i)=>{const a=(e,t)=>{e?i(e):o(t)};"run"==e?u.run(t,n,a):"get"==e?u.get(t,n,a):(e="all")&&u.all(t,n,a)})}))}function c(e){if(null!=e){var t=new a.Recurrence;return t.enabled=e.enabled,t.interval=e.interval,t.intervalNumber=e.intervalNumber,t.weekSunday=e.weekSunday,t.weekMonday=e.weekMonday,t.weekTuesday=e.weekTuesday,t.weekWednesday=e.weekWednesday,t.weekThursday=e.weekThursday,t.weekFriday=e.weekFriday,t.weekSaturday=e.weekSaturday,t.monthOrdinal=e.monthOrdinal,t.monthWeekday=e.monthWeekday,t.stopType=e.stopType,t.stopDate=e.stopDate,t.stopNumber=e.stopNumber,t}}t.setupDatabase=function(){return o(this,void 0,void 0,(function*(){var e=yield i.default.plugins.dataDir(),t=e+"/database.sqlite3";yield r.ensureDir(e),u=new d.Database(t),yield function(){return o(this,void 0,void 0,(function*(){s("run","\n        CREATE TABLE IF NOT EXISTS Recurrence (\n            id TEXT PRIMARY KEY, \n            enabled BOOLEAN,\n            interval TEXT,\n            intervalNumber INTEGER,\n            weekSunday BOOLEAN,\n            weekMonday BOOLEAN,\n            weekTuesday BOOLEAN,\n            weekWednesday BOOLEAN,\n            weekThursday BOOLEAN,\n            weekFriday BOOLEAN,\n            weekSaturday BOOLEAN,\n            monthOrdinal TEXT, \n            monthWeekday TEXT,\n            stopType TEXT,\n            stopDate TEXT,\n            stopNumber INTEGER\n        )\n    ",{})}))}()}))},t.createRecord=function(e,t){return o(this,void 0,void 0,(function*(){yield s("run","INSERT INTO Recurrence (id) VALUES ($id)",{$id:e}),yield l(e,t)}))},t.getAllRecords=function(){return o(this,void 0,void 0,(function*(){return(yield s("all","SELECT * FROM Recurrence",{})).map(e=>({id:e.id,recurrence:c(e)}))}))},t.getRecord=function(e){return o(this,void 0,void 0,(function*(){return c(yield s("get","SELECT * FROM Recurrence WHERE id = $id",{$id:e}))}))},t.updateRecord=l,t.deleteRecord=function(e){return o(this,void 0,void 0,(function*(){yield s("run","DELETE FROM Recurrence WHERE id = $id",{$id:e})}))}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,a){function r(e){try{u(o.next(e))}catch(e){a(e)}}function d(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,d)}u((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.connectNoteChangedCallback=t.setTaskDueDate=t.markTaskUncompleted=t.getNote=t.getAllNotes=void 0;const i=n(0);t.getAllNotes=function(){return o(this,void 0,void 0,(function*(){var e=[];let t=0;do{var n=yield i.default.data.get(["notes"],{fields:["id","todo_due","todo_completed"],page:t++});e=e.concat(n.items)}while(n.has_more);return e}))},t.getNote=function(e){return o(this,void 0,void 0,(function*(){try{return yield i.default.data.get(["notes",e],{fields:["id","todo_due","todo_completed"]})}catch(e){if("Not Found"!=e.message)throw e}}))},t.markTaskUncompleted=function(e){return o(this,void 0,void 0,(function*(){yield i.default.data.put(["notes",e],null,{todo_completed:0})}))},t.setTaskDueDate=function(e,t){return o(this,void 0,void 0,(function*(){yield i.default.data.put(["notes",e],null,{todo_due:t.getTime()})}))},t.connectNoteChangedCallback=function(e){return o(this,void 0,void 0,(function*(){var t=null;setInterval(yield function(){return o(this,void 0,void 0,(function*(){do{var n=yield i.default.data.get(["events"],{fields:["id","item_id","type"],cursor:t});for(var o of n.items)e(o);t=n.cursor}while(n.has_more)}))},1e4)}))}}]);